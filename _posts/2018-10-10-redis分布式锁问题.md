---
layout: post
title: "redis分布式锁问题"
date: 2018-10-09
tags: java
---

redis分布式锁，可以使用如SETEX(在键不存在时才创建)，并且设置锁的超时时间

使用redis做分布式锁需要注意释放锁的问题。
问题一：假设锁的超时时间是5秒，线程一处理速度很慢，用了5秒以上。此时锁被自动释放，线程二进来获取到锁，但线程一处理完业务后执行了unLock操作，导致线程二的锁被释放了。

可以在获取锁创建key时设置唯一value。当解锁时查询value。校验与这个线程获取锁时的key的value是否相同，如果相同才执行解锁操作。如果不相同说明这个线程的锁已经被释放了，不需要再解锁。

问题二：如果服务宕机无法执行unLock操作，只能等到锁自动过期了，才能被正常访问

